var E=Object.create;var P=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var _=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var B=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of T(t))!C.call(e,r)&&r!==n&&P(e,r,{get:()=>t[r],enumerable:!(i=I(t,r))||i.enumerable});return e};var K=(e,t,n)=>(n=e!=null?E(A(e)):{},B(t||!e||!e.__esModule?P(n,"default",{value:e,enumerable:!0}):n,e));var O=_((Y,R)=>{R.exports=d;d.flatten=d;d.unflatten=x;function j(e){return e&&e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function w(e){return e}function d(e,t){t=t||{};let n=t.delimiter||".",i=t.maxDepth,r=t.transformKey||w,o={};function p(l,m,g){g=g||1,Object.keys(l).forEach(function(a){let s=l[a],c=t.safe&&Array.isArray(s),f=Object.prototype.toString.call(s),u=j(s),b=f==="[object Object]"||f==="[object Array]",y=m?m+n+r(a):r(a);if(!c&&!u&&b&&Object.keys(s).length&&(!t.maxDepth||g<i))return p(s,y,g+1);o[y]=s})}return p(e),o}function x(e,t){t=t||{};let n=t.delimiter||".",i=t.overwrite||!1,r=t.transformKey||w,o={};if(j(e)||Object.prototype.toString.call(e)!=="[object Object]")return e;function l(a){let s=Number(a);return isNaN(s)||a.indexOf(".")!==-1||t.object?a:s}function m(a,s,c){return Object.keys(c).reduce(function(f,u){return f[a+n+u]=c[u],f},s)}function g(a){let s=Object.prototype.toString.call(a),c=s==="[object Array]",f=s==="[object Object]";if(a){if(c)return!a.length;if(f)return!Object.keys(a).length}else return!0}return e=Object.keys(e).reduce(function(a,s){let c=Object.prototype.toString.call(e[s]);return!(c==="[object Object]"||c==="[object Array]")||g(e[s])?(a[s]=e[s],a):m(s,a,d(e[s],t))},{}),Object.keys(e).forEach(function(a){let s=a.split(n).map(r),c=l(s.shift()),f=l(s[0]),u=o;for(;f!==void 0;){if(c==="__proto__")return;let b=Object.prototype.toString.call(u[c]),y=b==="[object Object]"||b==="[object Array]";if(!i&&!y&&typeof u[c]<"u")return;(i&&!y||!i&&u[c]==null)&&(u[c]=typeof f=="number"&&!t.object?[]:{}),u=u[c],s.length>0&&(c=l(s.shift()),f=l(s[0]))}u[c]=x(e[a],t)}),o}});function h(e){return t=>n=>e({settings:t,env:n})}var v=K(O(),1);var S=M;function M(e,t,n){var i,r;if(Array.isArray(t)&&(i=t.slice(0)),typeof t=="string"&&(i=t.split(".")),typeof t=="symbol"&&(i=[t]),!Array.isArray(i))throw new Error("props arg must be an array, a string or a symbol");if(r=i.pop(),!r)return!1;$(r);for(var o;o=i.shift();)if($(o),typeof e[o]>"u"&&(e[o]={}),e=e[o],!e||typeof e!="object")return!1;return e[r]=n,!0}function $(e){if(e=="__proto__"||e=="constructor"||e=="prototype")throw new Error("setting of prototype values not supported")}var N=h(({settings:e,env:t})=>({id:"samuelstroschein.inlangPluginJson",async config(){return{languages:await J({$fs:t.$fs,settings:e}),readResources:async n=>L({...n,$fs:t.$fs,settings:e}),writeResources:async n=>k({...n,$fs:t.$fs,settings:e})}}}));async function J(e){let[t,n]=e.settings.pathPattern.split("{language}"),i=await e.$fs.readdir(t),r=[];for(let o of i)typeof o=="string"&&o.endsWith(".json")&&r.push(o.replace(".json",""));return r}async function L(e){let t=[];for(let n of e.config.languages){let i=e.settings.pathPattern.replace("{language}",n),r=JSON.parse(await e.$fs.readFile(i,{encoding:"utf-8"})),o=(0,v.default)(r),p=e.settings.variableReferencePattern&&new RegExp(`(\\${e.settings.variableReferencePattern[0]}[^\\${e.settings.variableReferencePattern[1]}]+\\${e.settings.variableReferencePattern[1]})`,"g");t.push(z(o,n,p))}return console.log(t[1].body.find(n=>n.id.name==="variable-test")?.pattern.elements),t}async function k(e){for(let t of e.resources){let n=e.settings.pathPattern.replace("{language}",t.languageTag.name);await e.$fs.writeFile(n,D(t,e.settings.variableReferencePattern))}}function z(e,t,n){return{type:"Resource",languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([i,r])=>F(i,r,n))}}function F(e,t,n){let i=[];if(n){let r=t.split(n);for(let o=0;o<r.length;o++)n.test(r[o])?i.push({type:"Placeholder",body:{type:"VariableReference",name:r[o].slice(1,-1)}}):i.push({type:"Text",value:r[o]})}else i.push({type:"Text",value:t});return{type:"Message",id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:i}}}function D(e,t){let n={};return e.body.forEach(i=>{let[r,o]=V(i,t);S(n,r,o)}),JSON.stringify(n,null,2)}function V(e,t){let n=[];for(let r of e.pattern.elements)r.type==="Text"||!t?n.push(r.value):r.type==="Placeholder"&&n.push(`${t[0]}${r.body.name}${t[1]}`);let i=n.join("");return[e.id.name,i]}export{N as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
