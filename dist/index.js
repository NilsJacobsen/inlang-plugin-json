var E=Object.create;var j=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty;var T=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of F(t))!M.call(e,n)&&n!==s&&j(e,n,{get:()=>t[n],enumerable:!(r=v(t,n))||r.enumerable});return e};var K=(e,t,s)=>(s=e!=null?E(L(e)):{},_(t||!e||!e.__esModule?j(s,"default",{value:e,enumerable:!0}):s,e));var x=T((k,S)=>{S.exports=m;m.flatten=m;m.unflatten=P;function R(e){return e&&e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function C(e){return e}function m(e,t){t=t||{};let s=t.delimiter||".",r=t.maxDepth,n=t.transformKey||C,i={};function c(u,p,y){y=y||1,Object.keys(u).forEach(function(a){let o=u[a],f=t.safe&&Array.isArray(o),l=Object.prototype.toString.call(o),g=R(o),h=l==="[object Object]"||l==="[object Array]",d=p?p+s+n(a):n(a);if(!f&&!g&&h&&Object.keys(o).length&&(!t.maxDepth||y<r))return c(o,d,y+1);i[d]=o})}return c(e),i}function P(e,t){t=t||{};let s=t.delimiter||".",r=t.overwrite||!1,n=t.transformKey||C,i={};if(R(e)||Object.prototype.toString.call(e)!=="[object Object]")return e;function u(a){let o=Number(a);return isNaN(o)||a.indexOf(".")!==-1||t.object?a:o}function p(a,o,f){return Object.keys(f).reduce(function(l,g){return l[a+s+g]=f[g],l},o)}function y(a){let o=Object.prototype.toString.call(a),f=o==="[object Array]",l=o==="[object Object]";if(a){if(f)return!a.length;if(l)return!Object.keys(a).length}else return!0}return e=Object.keys(e).reduce(function(a,o){let f=Object.prototype.toString.call(e[o]);return!(f==="[object Object]"||f==="[object Array]")||y(e[o])?(a[o]=e[o],a):p(o,a,m(e[o],t))},{}),Object.keys(e).forEach(function(a){let o=a.split(s).map(n),f=u(o.shift()),l=u(o[0]),g=i;for(;l!==void 0;){if(f==="__proto__")return;let h=Object.prototype.toString.call(g[f]),d=h==="[object Object]"||h==="[object Array]";if(!r&&!d&&typeof g[f]<"u")return;(r&&!d||!r&&g[f]==null)&&(g[f]=typeof l=="number"&&!t.object?[]:{}),g=g[f],o.length>0&&(f=u(o.shift()),l=u(o[0]))}g[f]=P(e[a],t)}),i}});var w=J;function J(e,t,s){var r,n;if(Array.isArray(t)&&(r=t.slice(0)),typeof t=="string"&&(r=t.split(".")),typeof t=="symbol"&&(r=[t]),!Array.isArray(r))throw new Error("props arg must be an array, a string or a symbol");if(n=r.pop(),!n)return!1;O(n);for(var i;i=r.shift();)if(O(i),typeof e[i]>"u"&&(e[i]={}),e=e[i],!e||typeof e!="object")return!1;return e[n]=s,!0}function O(e){if(e=="__proto__"||e=="constructor"||e=="prototype")throw new Error("setting of prototype values not supported")}var b=K(x(),1);async function q(e){let[t,s]=e.pluginConfig.pathPattern.split("{language}");if(s.startsWith("/")){let n=[],i=await e.$fs.readdir(t);for(let c of i)if(!c.toString().includes("."))for(let u of await e.$fs.readdir(`${t}${c}`))typeof u=="string"&&u.endsWith(".json")&&!n.some(p=>p===c.toString())&&n.push(c.toString());return n}else{let n=await e.$fs.readdir(t),i=[];for(let c of n)typeof c=="string"&&c.endsWith(".json")&&i.push(c.replace(".json",""));return i}}async function G(e){let t=[];for(let s of e.config.languages){let r=e.pluginConfig.pathPattern.replace("{language}",s);try{let n=JSON.parse(await e.$fs.readFile(r,"utf-8")),i=(0,b.default)(n);t.push(A(i,s))}catch{let n={};for(let i of await e.$fs.readdir(`${r.replace("/*.json","")}`)){let c={};c[i.toString().replace(".json","")]=JSON.parse(await e.$fs.readFile(`${r.replace("/*.json","")}/${i}`,"utf-8"));let u=(0,b.default)(c);n={...n,...u}}t.push(A(n,s))}}return t}async function H(e){for(let t of e.resources){let[,s]=e.pluginConfig.pathPattern.split("{language}"),r=s.startsWith("/"),n=e.pluginConfig.pathPattern.replace("{language}",t.languageTag.name);if(r){let i=N(t.body);for(let c of i.prefixes){let u={type:t.type,languageTag:t.languageTag,body:i.messages[c]};await e.$fs.writeFile(n.replace("*",c),$(u))}}else await e.$fs.writeFile(n,$(t))}}function N(e){let t=[...new Set(e.map(r=>r.id.name.split(".")[0]))],s={prefixes:t,messages:{}};return t.forEach(r=>{s.messages[r]=e.filter(n=>n.id.name.startsWith(r)),s.messages[r].forEach(n=>{n.id.name=n.id.name.replace(`${r}.`,"")})}),s}function A(e,t){return{type:"Resource",languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([s,r])=>B(s,r))}}function B(e,t){return{type:"Message",id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:[{type:"Text",value:t}]}}}function $(e){let t={};return e.body.forEach(s=>{let[r,n]=I(s);w(t,r,n)}),JSON.stringify(t,null,2)}function I(e){return[e.id.name,e.pattern.elements[0].value]}export{q as getLanguages,G as readResources,H as writeResources};
